<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ urun.isim }} - BÃ¼yÃ¼lÃ¼ Sepet</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Kar Taneleri Animasyonu -->
    <div class="snowflakes" aria-hidden="true">
        <div class="snowflake">â…</div>
        <div class="snowflake">â†</div>
        <div class="snowflake">â…</div>
        <div class="snowflake">â†</div>
        <div class="snowflake">â…</div>
        <div class="snowflake">â†</div>
        <div class="snowflake">â…</div>
        <div class="snowflake">â†</div>
        <div class="snowflake">â…</div>
        <div class="snowflake">â†</div>
    </div>

    <!-- Navigasyon -->
    <header>
        <div class="navbar">
            <div class="logo">
                <h1><a href="/" style="text-decoration:none; color:inherit;">ğŸ BÃ¼yÃ¼lÃ¼ Sepet âœ¨</a></h1>
            </div>
            <div class="search-bar-container">
                <form action="/urunler" method="GET" class="search-form">
                    <input type="text" name="search" placeholder="ÃœrÃ¼n ara..." class="search-input">
                    <button type="submit" class="search-button">ğŸ”</button>
                </form>
            </div>
            <button class="menu-toggle" onclick="toggleMenu()">â˜°</button>
            <div class="nav-links" id="navMenu">
                <a href="/">Ana Sayfa</a>
                <a href="/urunler" class="active">ÃœrÃ¼nler</a>
                <a href="/urunler?kategori=cocuk" class="kids-link">ğŸˆ Ã‡ocuklar Ä°Ã§in</a>
                <a href="/hakkimizda">HakkÄ±mÄ±zda</a>
                <a href="/iletisim">Ä°letiÅŸim</a>
                <a href="/sepet" class="cart-fab">ğŸ›’ Sepet</a>
                {% if current_user.is_authenticated %}
                    <a href="/favoriler">â¤ï¸ Favoriler</a>
                    <a href="/support">ğŸ’¬ Destek</a>
                    <a href="/game" class="forest-link">ğŸŒ² BÃ¼yÃ¼lÃ¼ Orman</a>
                    <a href="/profile">ğŸ‘¤ {{ current_user.name.split()[0][0]}}.{{ current_user.name.split()[1][0] if current_user.name.split()|length > 1 else 'U' }}</a>
                    <a href="/logout">ğŸšª Ã‡Ä±kÄ±ÅŸ</a>
                {% else %}
                    <a href="/login">ğŸ” GiriÅŸ</a>
                    <a href="/register">âœ¨ KayÄ±t Ol</a>
                {% endif %}
            </div>
        </div>
    </header>
    <script>
        function toggleMenu() {
            const menu = document.getElementById('navMenu');
            menu.classList.toggle('active');
        }
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('navMenu');
            const toggle = document.querySelector('.menu-toggle');
            if (!menu.contains(event.target) && !toggle.contains(event.target)) {
                menu.classList.remove('active');
            }
        });

        // Search autocomplete system
        const products = [
            {id: 1, name: 'Sihirli Kar KÃ¼resi', category: 'Dekorasyon', icon: 'ğŸ”®'},
            {id: 2, name: 'Peri IÅŸÄ±ÄŸÄ± LambasÄ±', category: 'AydÄ±nlatma', icon: 'ğŸ’¡'},
            {id: 3, name: 'Elfler Ä°Ã§in El YapÄ±mÄ± AtkÄ±', category: 'Giyim', icon: 'ğŸ§£'},
            {id: 4, name: 'Ã‡am KozalaÄŸÄ± SÃ¼s Seti', category: 'Dekorasyon', icon: 'ğŸŒ²'},
            {id: 5, name: 'Geyik PeluÅŸ Oyuncak', category: 'Ã‡ocuk', icon: 'ğŸ¦Œ'},
            {id: 6, name: 'YÄ±ldÄ±z Tozlu Mum Seti', category: 'Dekorasyon', icon: 'ğŸ•¯ï¸'},
            {id: 7, name: 'BÃ¼yÃ¼lÃ¼ Sepet Ã‡ayÄ±', category: 'Yiyecek', icon: 'â˜•'},
            {id: 8, name: 'Sincap PeluÅŸ Ailesi', category: 'Ã‡ocuk', icon: 'ğŸ¿ï¸'},
            {id: 9, name: 'AhÅŸap KulÃ¼be MÃ¼zik Kutusu', category: 'Dekorasyon', icon: 'ğŸ '},
            {id: 10, name: 'Kar Tanesi KÃ¼pe Seti', category: 'Aksesuar', icon: 'ğŸ’'},
            {id: 11, name: 'Orman Ninnileri KitabÄ±', category: 'Ã‡ocuk', icon: 'ğŸ“–'},
            {id: 12, name: 'BÃ¼yÃ¼lÃ¼ Teraryum', category: 'Bitki', icon: 'ğŸŒ¿'},
            {id: 13, name: 'Kristal YÄ±ldÄ±z Kolye', category: 'Aksesuar', icon: 'â­'},
            {id: 14, name: 'Sihirli Mantar Lamba', category: 'AydÄ±nlatma', icon: 'ğŸ„'},
            {id: 15, name: 'Orman Eldiveni Seti', category: 'Giyim', icon: 'ğŸ§¤'},
            {id: 16, name: 'Noel Baba KapÄ± SÃ¼sÃ¼', category: 'Dekorasyon', icon: 'ğŸ…'},
            {id: 17, name: 'BÃ¼yÃ¼lÃ¼ Ã‡ikolata Kutusu', category: 'Yiyecek', icon: 'ğŸ«'},
            {id: 18, name: 'Kardan Adam PeluÅŸ', category: 'Ã‡ocuk', icon: 'â›„'},
            {id: 19, name: 'YÄ±lbaÅŸÄ± AÄŸacÄ± Topper YÄ±ldÄ±z', category: 'Dekorasyon', icon: 'ğŸŒŸ'},
            {id: 20, name: 'Peri KanatlÄ± YastÄ±k', category: 'Aksesuar', icon: 'ğŸ¦‹'},
            {id: 21, name: 'Elf ÅapkasÄ±', category: 'Giyim', icon: 'ğŸ©'},
            {id: 22, name: 'Orman Hikayeleri Seti', category: 'Ã‡ocuk', icon: 'ğŸ“š'},
            {id: 23, name: 'Mini Ã‡am AÄŸacÄ±', category: 'Bitki', icon: 'ğŸŒ²'},
            {id: 24, name: 'IÅŸÄ±klÄ± Geyik FigÃ¼rÃ¼', category: 'Dekorasyon', icon: 'ğŸ¦Œ'}
        ];

        const searchInput = document.querySelector('.search-input');
        const searchForm = document.querySelector('.search-form');
        let searchSuggestions = document.getElementById('searchSuggestions');
        
        // Create suggestions container if not exists
        if (!searchSuggestions && searchForm) {
            searchSuggestions = document.createElement('div');
            searchSuggestions.id = 'searchSuggestions';
            searchSuggestions.className = 'search-suggestions';
            searchForm.parentElement.appendChild(searchSuggestions);
        }

        if (searchInput && searchSuggestions) {
            searchInput.addEventListener('input', function() {
                const query = this.value.trim().toLowerCase();
                
                if (query.length === 0) {
                    searchSuggestions.classList.remove('active');
                    return;
                }

                const results = products.filter(p => 
                    p.name.toLowerCase().includes(query) || 
                    p.category.toLowerCase().includes(query)
                ).slice(0, 8);

                if (results.length > 0) {
                    searchSuggestions.innerHTML = results.map(item => `
                        <div class="suggestion-item" onclick="selectSuggestion(${item.id})">
                            <span class="suggestion-icon">${item.icon}</span>
                            <span class="suggestion-text">${item.name}</span>
                            <span class="suggestion-category">${item.category}</span>
                        </div>
                    `).join('');
                    searchSuggestions.classList.add('active');
                } else {
                    searchSuggestions.classList.remove('active');
                }
            });

            // Close suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !searchSuggestions.contains(e.target)) {
                    searchSuggestions.classList.remove('active');
                }
            });
        }

        function selectSuggestion(productId) {
            searchSuggestions.classList.remove('active');
            window.location.href = '/urun/' + productId;
        }
    </script>

    <!-- ÃœrÃ¼n Detay -->
    <main class="product-detail">
        <div class="container">
            <!-- Breadcrumb -->
            <div class="breadcrumb">
                <a href="/">Ana Sayfa</a> /
                <a href="/urunler">ÃœrÃ¼nler</a> /
                <a href="/urunler?kategori={{ urun.kategori }}">{{ urun.kategori }}</a> /
                <span>{{ urun.isim }}</span>
            </div>

            <!-- ÃœrÃ¼n Bilgileri -->
            <div class="product-detail-grid">
                <!-- ÃœrÃ¼n GÃ¶rseli -->
                <div class="product-detail-image">
                    <div class="image-badges">
                        <span class="badge-new">YENÄ°</span>
                        <span class="badge-special">Ã–ZEL</span>
                    </div>
                    <div class="detail-image-placeholder">
                        {{ urun.emoji if urun.emoji else 'âœ¨' }}
                    </div>
                </div>

                <!-- ÃœrÃ¼n DetaylarÄ± -->
                <div class="product-detail-info">
                    <span class="detail-category">{{ urun.kategori }}</span>
                    <h1 class="detail-title">{{ urun.isim }}</h1>

                    <div class="detail-rating">
                        <div class="stars">
                            {% for i in range(5) %}
                                {% if i < avg_rating %}â­{% else %}â˜†{% endif %}
                            {% endfor %}
                        </div>
                        <span class="review-count">({{ review_count }} deÄŸerlendirme{% if avg_rating > 0 %} - {{ "%.1f"|format(avg_rating) }}/5{% endif %})</span>
                    </div>

                    <p class="detail-description">{{ urun.aciklama }}</p>

                    <div class="detail-features">
                        <h3>âœ¨ ÃœrÃ¼n Ã–zellikleri</h3>
                        <ul>
                            <li>ğŸŒ² BÃ¼yÃ¼lÃ¼ ormandan Ã¶zel olarak seÃ§ilmiÅŸtir</li>
                            <li>ğŸ Ãœcretsiz hediye paketi ile gelir</li>
                            <li>âœ¨ Peri tozu ile gÃ¼Ã§lendirilmiÅŸ kalite</li>
                            <li>ğŸ”® Sihirli enerji barÄ±ndÄ±rÄ±r</li>
                            <li>ğŸ’ Sevdikleriniz iÃ§in mÃ¼kemmel hediye</li>
                            <li>ğŸŒŸ El yapÄ±mÄ± ve Ã¶zenle hazÄ±rlanmÄ±ÅŸ</li>
                        </ul>
                    </div>

                    <div class="detail-price-section">
                        <div class="price-box">
                            <span class="price-label">Fiyat:</span>
                            <span class="price-value">{{ "%.2f"|format(urun.fiyat) }} â‚º</span>
                        </div>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <a href="/sepete-ekle/{{ urun.id }}" class="btn-add-to-cart-large">
                                ğŸ›’ Sepete Ekle
                            </a>
                            {% if current_user.is_authenticated %}
                                <a href="/favoriye-ekle/{{ urun.id }}" class="btn-add-fav" style="font-size: 2em;">â¤ï¸</a>
                            {% endif %}
                        </div>
                    </div>

                    <div class="detail-shipping">
                        <p>ğŸš€ <strong>HÄ±zlÄ± Kargo:</strong> Noel Baba'nÄ±n geyikleri ile 1-2 gÃ¼n iÃ§inde teslimat</p>
                        <p>ğŸ… <strong>Ãœcretsiz Kargo:</strong> 200 â‚º ve Ã¼zeri alÄ±ÅŸveriÅŸlerde</p>
                        <p>ğŸ’ <strong>Hediye Paketi:</strong> TÃ¼m sipariÅŸlerde Ã¼cretsiz</p>
                        <p>ğŸ”„ <strong>Kolay Ä°ade:</strong> 30 gÃ¼n iÃ§inde iade garantisi</p>
                    </div>
                </div>
            </div>

            <!-- ÃœrÃ¼n Sekmeleri -->
            <div class="product-tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="openTab(event, 'aciklama')">ğŸ“ AÃ§Ä±klama</button>
                    <button class="tab-btn" onclick="openTab(event, 'ozellikler')">âš¡ Ã–zellikler</button>
                    <button class="tab-btn" onclick="openTab(event, 'yorumlar')">ğŸ’¬ Yorumlar</button>
                </div>

                <div id="aciklama" class="tab-content active">
                    <h3>ÃœrÃ¼n HakkÄ±nda</h3>
                    <p>{{ urun.aciklama }}</p>
                    <p>Bu Ã¶zel Ã¼rÃ¼n, bÃ¼yÃ¼lÃ¼ ormanÄ±n derinliklerinden gelen mistik bir hazinedir. Orman elflerinin Ã¶zenle hazÄ±rladÄ±ÄŸÄ± bu eÅŸsiz parÃ§a, yÄ±lbaÅŸÄ± ruhunu evinize taÅŸÄ±yacak. Her detayÄ± dÃ¼ÅŸÃ¼nÃ¼lmÃ¼ÅŸ, her kÃ¶ÅŸesine sevgi katÄ±lmÄ±ÅŸ bu muhteÅŸem Ã¼rÃ¼n, sevdiklerinize verebileceÄŸiniz en Ã¶zel hediyelerden biri.</p>
                    <p>Peri tozu ile serpilmiÅŸ, yÄ±ldÄ±z Ä±ÅŸÄ±ÄŸÄ±nda kurutulmuÅŸ ve sihirli bir bÃ¼yÃ¼ ile korunmuÅŸ bu Ã¼rÃ¼n, size yÄ±llar boyu eÅŸlik edecek. BÃ¼yÃ¼lÃ¼ ormanÄ±n sÄ±caklÄ±ÄŸÄ±nÄ±, periler diyarÄ±nÄ±n neÅŸesini ve yÄ±lbaÅŸÄ±nÄ±n coÅŸkusunu bir arada sunan bu benzersiz Ã¼rÃ¼nÃ¼ kaÃ§Ä±rmayÄ±n!</p>
                </div>

                <div id="ozellikler" class="tab-content">
                    <h3>Teknik Ã–zellikler</h3>
                    <ul>
                        <li><strong>Kategori:</strong> {{ urun.kategori }}</li>
                        <li><strong>Malzeme:</strong> BÃ¼yÃ¼lÃ¼ orman kaynaklÄ± Ã¶zel malzemeler</li>
                        <li><strong>Ãœretim:</strong> El yapÄ±mÄ±, sÄ±nÄ±rlÄ± Ã¼retim</li>
                        <li><strong>MenÅŸei:</strong> BÃ¼yÃ¼lÃ¼ Sepet, Kuzey Kutbu</li>
                        <li><strong>Sertifika:</strong> Peri Konseyi onaylÄ±</li>
                        <li><strong>Garanti:</strong> Sonsuz sihir garantisi</li>
                        <li><strong>Enerji:</strong> %100 pozitif bÃ¼yÃ¼ enerjisi</li>
                        <li><strong>BakÄ±m:</strong> Peri tozu ile hafif silmek yeterli</li>
                    </ul>
                </div>

                <div id="yorumlar" class="tab-content">
                    <div class="reviews-header">
                        <div>
                            <h3>MÃ¼ÅŸteri YorumlarÄ±</h3>
                            {% if reviews %}
                                <div class="review-stats">
                                    <span class="avg-rating">
                                        {% for i in range(avg_rating|int) %}â­{% endfor %}
                                        {% if (avg_rating % 1) >= 0.5 %}âœ¨{% endif %}
                                        <strong>({{ avg_rating|round(1) }}/5.0)</strong>
                                    </span>
                                    <span class="review-count">{{ review_count }} Yorum</span>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    {% if current_user.is_authenticated %}
                        <div class="review-form">
                            <h4>ğŸ“ Yorumunuzu PaylaÅŸÄ±n</h4>
                            <form action="/yorum-ekle/{{ urun.id }}" method="POST">
                                <div class="rating-input">
                                    <label>ÃœrÃ¼nÃ¼ KaÃ§ YÄ±ldÄ±z Verirsiniz?</label>
                                    <div class="star-rating-input">
                                        <input type="radio" id="star5" name="rating" value="5" required>
                                        <label for="star5" class="star-label">â­</label>
                                        <input type="radio" id="star4" name="rating" value="4">
                                        <label for="star4" class="star-label">â­</label>
                                        <input type="radio" id="star3" name="rating" value="3">
                                        <label for="star3" class="star-label">â­</label>
                                        <input type="radio" id="star2" name="rating" value="2">
                                        <label for="star2" class="star-label">â­</label>
                                        <input type="radio" id="star1" name="rating" value="1">
                                        <label for="star1" class="star-label">â­</label>
                                    </div>
                                </div>
                                <div class="comment-input">
                                    <label for="comment">DÃ¼ÅŸÃ¼nceleriniz:</label>
                                    <textarea id="comment" name="comment" rows="4" placeholder="ÃœrÃ¼n hakkÄ±nda deneyiminizi paylaÅŸÄ±n... (zorunlu deÄŸil)"></textarea>
                                </div>
                                <button type="submit" class="btn-submit-review">âœ¨ Yorum GÃ¶nder</button>
                            </form>
                        </div>
                    {% else %}
                        <div class="review-login-prompt">
                            <p>ğŸ’¬ Yorum yapmak iÃ§in <a href="/login" style="color: var(--gold-primary); font-weight: 600;">GiriÅŸ yapÄ±n</a></p>
                        </div>
                    {% endif %}

                    <div class="reviews-list">
                        {% if reviews %}
                            <h4 style="margin-top: 40px; margin-bottom: 20px;">ğŸ“Œ Son Yorumlar</h4>
                            {% for review in reviews %}
                                <div class="review-item">
                                    <div class="review-card-header">
                                        <div class="reviewer-info">
                                            <span class="reviewer-avatar">ğŸ‘¤</span>
                                            <div class="reviewer-details">
                                                <strong class="reviewer-name">{{ review.user.name.split()[0] }}</strong>
                                                <span class="review-date">{{ review.created_at.strftime('%d.%m.%Y') }}</span>
                                            </div>
                                        </div>
                                        <div class="review-rating">
                                            {% for i in range(review.rating) %}â­{% endfor %}
                                            {% for i in range(5 - review.rating) %}<span style="opacity: 0.3;">â­</span>{% endfor %}
                                        </div>
                                    </div>
                                    {% if review.comment %}
                                        <p class="review-comment">{{ review.comment }}</p>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-reviews">
                                <p style="font-size: 1.2em; margin: 40px 0; text-align: center; color: var(--text-secondary);">
                                    âœ¨ HenÃ¼z yorum yapÄ±lmamÄ±ÅŸ. Ä°lk yorumu siz yapÄ±n!
                                </p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>ğŸ BÃ¼yÃ¼lÃ¼ Sepet</h3>
                <p>YÄ±lbaÅŸÄ±nÄ±n sihirli dÃ¼nyasÄ±na hoÅŸ geldiniz! BÃ¼yÃ¼lÃ¼ ormanÄ±n en Ã¶zel Ã¼rÃ¼nleriyle sizlere hizmet veriyoruz.</p>
                <p>ğŸ“ BÃ¼yÃ¼lÃ¼ Sepet, Kuzey Kutbu, Peri Vadisi No: 25</p>
            </div>
            <div class="footer-section">
                <h3>HÄ±zlÄ± Linkler</h3>
                <ul>
                    <li><a href="/">Ana Sayfa</a></li>
                    <li><a href="/urunler">ÃœrÃ¼nler</a></li>
                    <li><a href="/hakkimizda">HakkÄ±mÄ±zda</a></li>
                    <li><a href="/iletisim">Ä°letiÅŸim</a></li>
                    <li><a href="/sepet">Sepetim</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Kategoriler</h3>
                <ul>
                    <li><a href="/urunler?kategori=Dekorasyon">Dekorasyon</a></li>
                    <li><a href="/urunler?kategori=Oyuncak">Oyuncaklar</a></li>
                    <li><a href="/urunler?kategori=AydÄ±nlatma">AydÄ±nlatma</a></li>
                    <li><a href="/urunler?kategori=Giyim">Giyim</a></li>
                    <li><a href="/urunler?kategori=Aksesuar">Aksesuarlar</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Ä°letiÅŸim</h3>
                <p>ğŸ“§ info@buyuluorman.com</p>
                <p>ğŸ“± +90 (555) 123 45 67</p>
                <p>ğŸ• Pazartesi - Pazar: 00:00 - 24:00</p>
                <p style="margin-top: 15px;">âœ¨ BÃ¼yÃ¼lÃ¼ ormanÄ±mÄ±z 7/24 aÃ§Ä±k!</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 BÃ¼yÃ¼lÃ¼ Sepet - YÄ±lbaÅŸÄ± AlÄ±ÅŸveriÅŸ MaÄŸazasÄ±. TÃ¼m haklarÄ± saklÄ±dÄ±r. âœ¨ğŸ„</p>
        </div>
    </footer>

    <!-- Tab JavaScript -->
    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;

            // TÃ¼m tab iÃ§eriklerini gizle
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }

            // TÃ¼m butonlardan active class'Ä±nÄ± kaldÄ±r
            tablinks = document.getElementsByClassName("tab-btn");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }

            // SeÃ§ili tab'Ä± gÃ¶ster
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }

        // Sayfa yÃ¼klendiÄŸinde ilk sekmeyi aktif et
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('aciklama').classList.add('active');
            document.querySelector('.tab-btn').classList.add('active');
        });

        // Toast notification gÃ¶ster
        {% if session.last_added_product %}
        const toast = document.getElementById('cartToast');
        const productName = document.getElementById('toastProductName');
        const productPrice = document.getElementById('toastProductPrice');

        productName.textContent = '{{ session.last_added_product.isim }}';
        productPrice.textContent = '{{ "%.2f"|format(session.last_added_product.fiyat) }} â‚º';

        toast.classList.add('show');

        setTimeout(function() {
            toast.classList.remove('show');
        }, 4000);
        {% endif %}
    </script>

    <!-- Toast Notification -->
    <div id="cartToast" class="cart-toast">
        <div class="toast-content">
            <div class="toast-icon">âœ…</div>
            <div class="toast-info">
                <div class="toast-title">Sepete Eklendi!</div>
                <div class="toast-product-name" id="toastProductName"></div>
                <div class="toast-product-price" id="toastProductPrice"></div>
            </div>
        </div>
    </div>
</body>
</html>
