<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sepetim - BÃ¼yÃ¼lÃ¼ Sepet</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Kar Taneleri Animasyonu -->
    <div class="snowflakes" aria-hidden="true">
        <div class="snowflake">â…</div>
        <div class="snowflake">â†</div>
        <div class="snowflake">â…</div>
        <div class="snowflake">â†</div>
        <div class="snowflake">â…</div>
        <div class="snowflake">â†</div>
        <div class="snowflake">â…</div>
        <div class="snowflake">â†</div>
        <div class="snowflake">â…</div>
        <div class="snowflake">â†</div>
    </div>

    <!-- Navigasyon -->
    <header>
        <div class="navbar">
            <div class="logo">
                <h1><a href="/" style="text-decoration:none; color:inherit;">ğŸ BÃ¼yÃ¼lÃ¼ Sepet âœ¨</a></h1>
            </div>
            <div class="search-bar-container">
                <form action="/urunler" method="GET" class="search-form">
                    <input type="text" name="search" placeholder="ÃœrÃ¼n ara..." class="search-input">
                    <button type="submit" class="search-button">ğŸ”</button>
                </form>
            </div>
            <button class="menu-toggle" onclick="toggleMenu()">â˜°</button>
            <div class="nav-links" id="navMenu">
                <a href="/">Ana Sayfa</a>
                <a href="/urunler">ÃœrÃ¼nler</a>
                <a href="/urunler?kategori=cocuk" class="kids-link">ğŸˆ Ã‡ocuklar Ä°Ã§in</a>
                <a href="/hakkimizda">HakkÄ±mÄ±zda</a>
                <a href="/iletisim">Ä°letiÅŸim</a>
                <a href="/sepet" class="active cart-fab">ğŸ›’ Sepet</a>
                {% if current_user.is_authenticated %}
                    <a href="/favoriler">â¤ï¸ Favoriler</a>
                    <a href="/support">ğŸ’¬ Destek</a>
                    <a href="/game" class="forest-link">ğŸŒ² BÃ¼yÃ¼lÃ¼ Orman</a>
                    <a href="/profile">ğŸ‘¤ {{ current_user.name.split()[0][0]}}.{{ current_user.name.split()[1][0] if current_user.name.split()|length > 1 else 'U' }}</a>
                    <a href="/logout">ğŸšª Ã‡Ä±kÄ±ÅŸ</a>
                {% else %}
                    <a href="/login">ğŸ” GiriÅŸ</a>
                    <a href="/register">âœ¨ KayÄ±t Ol</a>
                {% endif %}
            </div>
        </div>
    </header>
    <script>
        function toggleMenu() {
            const menu = document.getElementById('navMenu');
            menu.classList.toggle('active');
        }
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('navMenu');
            const toggle = document.querySelector('.menu-toggle');
            if (!menu.contains(event.target) && !toggle.contains(event.target)) {
                menu.classList.remove('active');
            }
        });

        // Search autocomplete system
        const products = [
            {id: 1, name: 'Sihirli Kar KÃ¼resi', category: 'Dekorasyon', icon: 'ğŸ”®'},
            {id: 2, name: 'Peri IÅŸÄ±ÄŸÄ± LambasÄ±', category: 'AydÄ±nlatma', icon: 'ğŸ’¡'},
            {id: 3, name: 'Elfler Ä°Ã§in El YapÄ±mÄ± AtkÄ±', category: 'Giyim', icon: 'ğŸ§£'},
            {id: 4, name: 'Ã‡am KozalaÄŸÄ± SÃ¼s Seti', category: 'Dekorasyon', icon: 'ğŸŒ²'},
            {id: 5, name: 'Geyik PeluÅŸ Oyuncak', category: 'Ã‡ocuk', icon: 'ğŸ¦Œ'},
            {id: 6, name: 'YÄ±ldÄ±z Tozlu Mum Seti', category: 'Dekorasyon', icon: 'ğŸ•¯ï¸'},
            {id: 7, name: 'BÃ¼yÃ¼lÃ¼ Sepet Ã‡ayÄ±', category: 'Yiyecek', icon: 'â˜•'},
            {id: 8, name: 'Sincap PeluÅŸ Ailesi', category: 'Ã‡ocuk', icon: 'ğŸ¿ï¸'},
            {id: 9, name: 'AhÅŸap KulÃ¼be MÃ¼zik Kutusu', category: 'Dekorasyon', icon: 'ğŸ '},
            {id: 10, name: 'Kar Tanesi KÃ¼pe Seti', category: 'Aksesuar', icon: 'ğŸ’'},
            {id: 11, name: 'Orman Ninnileri KitabÄ±', category: 'Ã‡ocuk', icon: 'ğŸ“–'},
            {id: 12, name: 'BÃ¼yÃ¼lÃ¼ Teraryum', category: 'Bitki', icon: 'ğŸŒ¿'},
            {id: 13, name: 'Kristal YÄ±ldÄ±z Kolye', category: 'Aksesuar', icon: 'â­'},
            {id: 14, name: 'Sihirli Mantar Lamba', category: 'AydÄ±nlatma', icon: 'ğŸ„'},
            {id: 15, name: 'Orman Eldiveni Seti', category: 'Giyim', icon: 'ğŸ§¤'},
            {id: 16, name: 'Noel Baba KapÄ± SÃ¼sÃ¼', category: 'Dekorasyon', icon: 'ğŸ…'},
            {id: 17, name: 'BÃ¼yÃ¼lÃ¼ Ã‡ikolata Kutusu', category: 'Yiyecek', icon: 'ğŸ«'},
            {id: 18, name: 'Kardan Adam PeluÅŸ', category: 'Ã‡ocuk', icon: 'â›„'},
            {id: 19, name: 'YÄ±lbaÅŸÄ± AÄŸacÄ± Topper YÄ±ldÄ±z', category: 'Dekorasyon', icon: 'ğŸŒŸ'},
            {id: 20, name: 'Peri KanatlÄ± YastÄ±k', category: 'Aksesuar', icon: 'ğŸ¦‹'},
            {id: 21, name: 'Elf ÅapkasÄ±', category: 'Giyim', icon: 'ğŸ©'},
            {id: 22, name: 'Orman Hikayeleri Seti', category: 'Ã‡ocuk', icon: 'ğŸ“š'},
            {id: 23, name: 'Mini Ã‡am AÄŸacÄ±', category: 'Bitki', icon: 'ğŸŒ²'},
            {id: 24, name: 'IÅŸÄ±klÄ± Geyik FigÃ¼rÃ¼', category: 'Dekorasyon', icon: 'ğŸ¦Œ'}
        ];

        const searchInput = document.querySelector('.search-input');
        const searchForm = document.querySelector('.search-form');
        let searchSuggestions = document.getElementById('searchSuggestions');
        
        // Create suggestions container if not exists
        if (!searchSuggestions && searchForm) {
            searchSuggestions = document.createElement('div');
            searchSuggestions.id = 'searchSuggestions';
            searchSuggestions.className = 'search-suggestions';
            searchForm.parentElement.appendChild(searchSuggestions);
        }

        if (searchInput && searchSuggestions) {
            searchInput.addEventListener('input', function() {
                const query = this.value.trim().toLowerCase();
                
                if (query.length === 0) {
                    searchSuggestions.classList.remove('active');
                    return;
                }

                const results = products.filter(p => 
                    p.name.toLowerCase().includes(query) || 
                    p.category.toLowerCase().includes(query)
                ).slice(0, 8);

                if (results.length > 0) {
                    searchSuggestions.innerHTML = results.map(item => `
                        <div class="suggestion-item" onclick="selectSuggestion(${item.id})">
                            <span class="suggestion-icon">${item.icon}</span>
                            <span class="suggestion-text">${item.name}</span>
                            <span class="suggestion-category">${item.category}</span>
                        </div>
                    `).join('');
                    searchSuggestions.classList.add('active');
                } else {
                    searchSuggestions.classList.remove('active');
                }
            });

            // Close suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !searchSuggestions.contains(e.target)) {
                    searchSuggestions.classList.remove('active');
                }
            });
        }

        function selectSuggestion(productId) {
            searchSuggestions.classList.remove('active');
            window.location.href = '/urun/' + productId;
        }
    </script>

    <!-- Sepet SayfasÄ± -->
    <main class="cart-page">
        <div class="container">
            <h1 class="page-title">ğŸ›’ AlÄ±ÅŸveriÅŸ Sepetim</h1>

            {% if sepet and sepet|length > 0 %}
                <div class="cart-layout">
                    <!-- Sepet ÃœrÃ¼nleri -->
                    <div class="cart-items">
                        {% for urun in sepet %}
                            <div class="cart-item">
                                <div class="cart-item-image">
                                    <div class="cart-placeholder">
                                        {% if urun.kategori == 'Dekorasyon' %}ğŸ„
                                        {% elif urun.kategori == 'AydÄ±nlatma' %}ğŸ’¡
                                        {% elif urun.kategori == 'Giyim' %}ğŸ§£
                                        {% elif urun.kategori == 'Oyuncak' %}ğŸ
                                        {% elif urun.kategori == 'Aksesuar' %}ğŸ’
                                        {% elif urun.kategori == 'Yiyecek' %}â˜•
                                        {% elif urun.kategori == 'Kitap' %}ğŸ“š
                                        {% elif urun.kategori == 'Bitki' %}ğŸŒ¿
                                        {% else %}âœ¨
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="cart-item-details">
                                    <h3>{{ urun.isim }}</h3>
                                    <p class="cart-item-category">{{ urun.kategori }}</p>
                                    <p class="cart-item-price">Birim Fiyat: {{ "%.2f"|format(urun.fiyat) }} â‚º</p>
                                </div>

                                <div class="cart-item-quantity">
                                    <label>Adet</label>
                                    <div class="quantity-controls">
                                        <a href="/adet-guncelle/{{ urun.id }}/azalt" class="qty-btn">-</a>
                                        <span class="qty-value">{{ urun.adet }}</span>
                                        <a href="/adet-guncelle/{{ urun.id }}/artir" class="qty-btn">+</a>
                                    </div>
                                </div>

                                <div class="cart-item-total">
                                    <div class="item-total-label">Toplam</div>
                                    <div class="item-total-price">{{ "%.2f"|format(urun.fiyat * urun.adet) }} â‚º</div>
                                </div>

                                <div class="cart-item-remove">
                                    <a href="/sepetten-cikar/{{ urun.id }}" class="btn-remove" title="Sepetten Ã‡Ä±kar">ğŸ—‘ï¸</a>
                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Sepet Ã–zeti -->
                    <div class="cart-summary">
                        <h2>Sepet Ã–zeti</h2>

                        <div class="summary-row">
                            <span>ÃœrÃ¼n SayÄ±sÄ±:</span>
                            <strong>{{ sepet|length }} Ã‡eÅŸit</strong>
                        </div>

                        <div class="summary-row">
                            <span>Toplam Adet:</span>
                            <strong>{{ sepet|sum(attribute='adet') }} Adet</strong>
                        </div>

                        <div class="summary-row">
                            <span>Ara Toplam:</span>
                            <strong>{{ "%.2f"|format(toplam) }} â‚º</strong>
                        </div>

                        <!-- Kupon Kodu BÃ¶lÃ¼mÃ¼ -->
                        <div class="coupon-section">
                            {% if kupon_kod %}
                                <div class="coupon-applied">
                                    <div class="coupon-info">
                                        <span class="coupon-icon">ğŸ‰</span>
                                        <div>
                                            <strong>{{ kupon_kod }}</strong>
                                            <small>%{{ indirim_yuzdesi }} indirim</small>
                                        </div>
                                    </div>
                                    <a href="/kupon-kaldir" class="btn-remove-coupon">Ã—</a>
                                </div>
                                <div class="summary-row discount-row">
                                    <span>Ä°ndirim:</span>
                                    <strong style="color: #2ecc71;">-{{ "%.2f"|format(indirim) }} â‚º</strong>
                                </div>
                            {% else %}
                                <form action="/kupon-uygula" method="POST" class="coupon-form">
                                    <input type="text" name="kupon_kod" placeholder="Kupon kodunuz..." class="coupon-input" maxlength="20">
                                    <button type="submit" class="btn-apply-coupon">Uygula</button>
                                </form>
                            {% endif %}
                        </div>

                        {% if toplam >= 200 %}
                            <div class="summary-info">
                                ğŸ‰ Tebrikler! Ãœcretsiz kargo kazandÄ±nÄ±z!
                            </div>
                            <div class="summary-row">
                                <span>Kargo:</span>
                                <strong style="color: #2ecc71;">ÃœCRETSÄ°Z</strong>
                            </div>
                        {% else %}
                            <div class="summary-info">
                                ğŸš€ {{ "%.2f"|format(200 - toplam) }} â‚º daha alÄ±ÅŸveriÅŸ yapÄ±n, Ã¼cretsiz kargo kazanÄ±n!
                            </div>
                            <div class="summary-row">
                                <span>Kargo:</span>
                                <strong>29,90 â‚º</strong>
                            </div>
                        {% endif %}

                        <div class="summary-total summary-row">
                            <span>GENEL TOPLAM:</span>
                            <strong>{{ "%.2f"|format(net_toplam + (0 if toplam >= 200 else 29.90)) }} â‚º</strong>
                        </div>

                        {% if current_user.is_authenticated %}
                            <a href="/checkout" class="btn-checkout" style="display:block; text-align:center; text-decoration:none;">
                                ğŸ’³ Ã–demeye GeÃ§
                            </a>
                            <a href="/sepeti-bosalt" class="btn-clear-cart" style="display:block; text-align:center; text-decoration:none; margin-top: 10px;" 
                               onclick="return confirm('Sepeti tamamen boÅŸaltmak istediÄŸinizden emin misiniz?');">
                                ğŸ—‘ï¸ Sepeti BoÅŸalt
                            </a>
                        {% else %}
                            <a href="/login" class="btn-checkout" style="display:block; text-align:center; text-decoration:none;">
                                ğŸ” SipariÅŸ Ä°Ã§in GiriÅŸ YapÄ±n
                            </a>
                        {% endif %}

                        <a href="/urunler" class="btn-continue-shopping-small">
                            â† AlÄ±ÅŸveriÅŸe Devam Et
                        </a>

                        <div class="cart-benefits">
                            <h3>ğŸ AvantajlarÄ±nÄ±z</h3>
                            <ul>
                                <li>âœ… Ãœcretsiz hediye paketi</li>
                                <li>âœ… 30 gÃ¼n iÃ§inde kolay iade</li>
                                <li>âœ… Sihirli kalite garantisi</li>
                                <li>âœ… Peri tozu ile korunmuÅŸ Ã¼rÃ¼nler</li>
                                <li>âœ… HÄ±zlÄ± teslimat (1-2 gÃ¼n)</li>
                            </ul>
                        </div>
                    </div>
                </div>

            {% else %}
                <!-- BoÅŸ Sepet -->
                <div class="empty-cart">
                    <div class="empty-cart-icon">ğŸ›’</div>
                    <h2>Sepetiniz BoÅŸ</h2>
                    <p>BÃ¼yÃ¼lÃ¼ ormanÄ±n sihirli Ã¼rÃ¼nlerini keÅŸfetmeye ne dersiniz?</p>
                    <a href="/urunler" class="btn-continue-shopping">
                        ğŸŒ² AlÄ±ÅŸveriÅŸe BaÅŸla
                    </a>
                </div>
            {% endif %}
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>ğŸ BÃ¼yÃ¼lÃ¼ Sepet</h3>
                <p>YÄ±lbaÅŸÄ±nÄ±n sihirli dÃ¼nyasÄ±na hoÅŸ geldiniz! BÃ¼yÃ¼lÃ¼ ormanÄ±n en Ã¶zel Ã¼rÃ¼nleriyle sizlere hizmet veriyoruz.</p>
                <p>ğŸ“ BÃ¼yÃ¼lÃ¼ Sepet, Kuzey Kutbu, Peri Vadisi No: 25</p>
            </div>
            <div class="footer-section">
                <h3>HÄ±zlÄ± Linkler</h3>
                <ul>
                    <li><a href="/">Ana Sayfa</a></li>
                    <li><a href="/urunler">ÃœrÃ¼nler</a></li>
                    <li><a href="/hakkimizda">HakkÄ±mÄ±zda</a></li>
                    <li><a href="/iletisim">Ä°letiÅŸim</a></li>
                    <li><a href="/sepet">Sepetim</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Kategoriler</h3>
                <ul>
                    <li><a href="/urunler?kategori=Dekorasyon">Dekorasyon</a></li>
                    <li><a href="/urunler?kategori=Oyuncak">Oyuncaklar</a></li>
                    <li><a href="/urunler?kategori=AydÄ±nlatma">AydÄ±nlatma</a></li>
                    <li><a href="/urunler?kategori=Giyim">Giyim</a></li>
                    <li><a href="/urunler?kategori=Aksesuar">Aksesuarlar</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Ä°letiÅŸim</h3>
                <p>ğŸ“§ info@buyuluorman.com</p>
                <p>ğŸ“± +90 (555) 123 45 67</p>
                <p>ğŸ• Pazartesi - Pazar: 00:00 - 24:00</p>
                <p style="margin-top: 15px;">âœ¨ BÃ¼yÃ¼lÃ¼ ormanÄ±mÄ±z 7/24 aÃ§Ä±k!</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 BÃ¼yÃ¼lÃ¼ Sepet - YÄ±lbaÅŸÄ± AlÄ±ÅŸveriÅŸ MaÄŸazasÄ±. TÃ¼m haklarÄ± saklÄ±dÄ±r. âœ¨ğŸ„</p>
        </div>
    </footer>
</body>
</html>
